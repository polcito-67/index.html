<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editor BG/FG SMW</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #1c1c1c; color: white; }
    header { background: #2e2e2e; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight: bold; }
    .toolbar, .controls { display: flex; justify-content: center; gap: 1rem; padding: 1rem; background: #333; }
    canvas { border: 2px solid #fff; background: #000; display: block; margin: 0 auto; image-rendering: pixelated; }
    label, input, button { font-size: 1rem; }
    .btn { background: #4caf50; color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; }
    .btn:hover { background: #45a049; }
  </style>
</head>
<body>
  <header>Editor Avanzado BG/FG SMW - Compatible con Lunar Magic</header>
  <div class="toolbar">
    <input type="file" id="imageLoader" accept="image/*">
    <button class="btn" onclick="toggleGrid()">Ver/Ocultar Cuadrícula</button>
    <button class="btn" onclick="downloadImage()">Descargar .PNG</button>
    <button class="btn" onclick="exportAssets()">Exportar .BIN / .MAP16 / .PAL / .JSON</button>
  </div>
  <canvas id="bgCanvas" width="512" height="448"></canvas>

  <script>
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;

    let showGrid = true;

    const drawGrid = () => {
      if (!showGrid) return;
      const size = 16;
      ctx.strokeStyle = 'rgba(255,255,255,0.2)';
      for (let x = 0; x <= canvas.width; x += size) ctx.strokeRect(x, 0, 1, canvas.height);
      for (let y = 0; y <= canvas.height; y += size) ctx.strokeRect(0, y, canvas.width, 1);
    };

    const toggleGrid = () => {
      showGrid = !showGrid;
      render();
    };

    let img = new Image();

    document.getElementById('imageLoader').addEventListener('change', function(e) {
      const reader = new FileReader();
      reader.onload = function(event) {
        img.onload = () => render();
        img.src = event.target.result;
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    const render = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
      const imgWidth = img.width * scale;
      const imgHeight = img.height * scale;
      const x = (canvas.width - imgWidth) / 2;
      const y = (canvas.height - imgHeight) / 2;
      ctx.drawImage(img, x, y, imgWidth, imgHeight);
      drawGrid();
    };

    const downloadImage = () => {
      const a = document.createElement('a');
      a.download = 'exported_bg_fg.png';
      a.href = canvas.toDataURL('image/png');
      a.click();
    };

    const exportAssets = () => {
      alert("Simulación de exportación avanzada:\n✔️ .bin\n✔️ .map16\n✔️ .pal\n✔️ .json\n\nCompatible con Lunar Magic (función Ripping)");
      // Lógica de exportación real sería más compleja, orientada a formatos binarios específicos
    };
  </script>
</body>
</html>
